<?php
/**
 * Хелпер для вывода описаний разделов
 */

require_once __DIR__ . '/settings.php';

if (!function_exists('renderSectionDescription')) {
    function renderSectionDescription(string $sectionKey): void
    {
        static $showDescriptions = null;
        if ($showDescriptions === null) {
            $showDescriptions = (bool)getSettingInt('show_section_descriptions', 1);
        }

        if (!$showDescriptions) {
            return;
        }

        $descriptions = [
            'users' => [
                'title' => 'Для чего нужен раздел «Пользователи»',
                'text' => [
                    'Создавайте и управляйте учетными записями сотрудников, назначайте роли администратора или пользователя и восстанавливайте доступ.',
                    'Используйте блокировку вместо удаления, чтобы сохранить историю действий и отчётность.',
                ],
            ],
            'pools' => [
                'title' => 'Для чего нужен раздел «Бассейны»',
                'text' => [
                    'Ведите справочник производственных бассейнов, задавайте их порядок отображения на рабочих страницах с помощью drag-n-drop.',
                    'От правильной сортировки зависит расположение карточек на странице «Рабочая».',
                ],
            ],
            'plantings' => [
                'title' => 'Для чего нужен раздел «Посадки»',
                'text' => [
                    'Фиксируйте партии малька: породу, даты вылупа и посадки, количество, биомассу и сопроводительные документы.',
                    'Здесь же можно архивировать завершённые партии и хранить пакет документов для каждой поставки.',
                ],
            ],
            'counterparties' => [
                'title' => 'Для чего нужен раздел «Контрагенты»',
                'text' => [
                    'Ведите справочник юридических и физических лиц, с которыми работает хозяйство: контакты, ИНН и описание условий.',
                    'Храните цветовую маркировку и сопроводительные документы, чтобы быстро находить нужного поставщика или клиента.',
                ],
            ],
            'sessions' => [
                'title' => 'Для чего нужен раздел «Сессии»',
                'text' => [
                    'Сессия — это производственный цикл конкретной посадки в выбранном бассейне. Здесь создаются и закрываются сессии.',
                    'Контролируйте стартовые параметры, прошлый FCR, следите за завершёнными циклами и избегайте пересечения активных сессий в одном бассейне.',
                ],
            ],
            'measurements' => [
                'title' => 'Для чего нужен раздел «Замеры»',
                'text' => [
                    'Вносите данные по температуре и растворённому кислороду. Регламент замеров — минимум три раза в день: 08:00, 14:00 и 20:00.',
                    'Администратор может редактировать любые записи, пользователи — только свои и в течение ограниченного времени.',
                ],
            ],
            'harvests' => [
                'title' => 'Для чего нужен раздел «Отборы»',
                'text' => [
                    'Фиксируйте отбор рыбы на продажу: вес и количество особей с привязкой к бассейну и сессии.',
                    'Данные отборов используются для аналитики и расчёта динамики поголовья.',
                ],
            ],
            'mortality' => [
                'title' => 'Для чего нужен раздел «Падеж»',
                'text' => [
                    'Регистрируйте случаи гибели рыбы: количество штук и сопутствующую информацию по бассейну и сессии.',
                    'Оперативная фиксация падежа помогает анализировать риски и отслеживать превышение допустимых порогов.',
                ],
            ],
            'weighings' => [
                'title' => 'Для чего нужен раздел «Навески»',
                'text' => [
                    'Проводите контрольные взвешивания, чтобы отслеживать средний вес особей и корректировать рацион.',
                    'Навески учитываются при расчёте средней массы в рабочих блоках и на графиках сессий.',
                ],
            ],
            'tasks' => [
                'title' => 'Для чего нужен раздел «Задачи»',
                'text' => [
                    'Используйте чек-листы в стиле Basecamp для постановки задач сотрудникам, контроля сроков и файлового сопровождения.',
                    'Администраторы управляют задачами и подзадачами, исполнители отмечают прогресс прямо из карточки.',
                ],
            ],
            'payroll' => [
                'title' => 'Для чего нужен раздел «ФЗП»',
                'text' => [
                    'Просматривайте сотрудников с регулярной зарплатой и реквизитами для выплат, чтобы быстро подготовить ведомость.',
                    'Ведите учёт дополнительных работ: фиксируйте задания, суммы и отмечайте факт выплаты сразу после закрытия.',
                ],
            ],
            'news' => [
                'title' => 'Для чего нужен раздел «Новости»',
                'text' => [
                    'Публикуйте важные объявления и оперативную информацию для команды — актуальная новость отображается на главной странице.',
                    'Используйте визуальный редактор, чтобы форматировать текст, добавлять ссылки и структурировать сообщения.',
                ],
            ],
            'meters' => [
                'title' => 'Для чего нужен раздел «Приборы учета»',
                'text' => [
                    'Ведите перечень приборов учета: электроэнергия, вода и другие. Каждому прибору можно добавить описание и назначение.',
                    'Список приборов используется при внесении показаний — следите за актуальностью и корректностью справочника.',
                ],
            ],
            'meter_readings' => [
                'title' => 'Как работать с показаниями приборов учета',
                'text' => [
                    'Выбирайте прибор в верхних вкладках и заносите фактические показания. Указывайте только числовое значение — дата и автор фиксируются автоматически.',
                    'Администраторы могут редактировать и удалять любые показания. Пользователь вправе изменить свои записи в течение установленного тайм-аута после создания.',
                ],
            ],
            'logs' => [
                'title' => 'Для чего нужен раздел «Логи»',
                'text' => [
                    'Просматривайте историю действий пользователей, фильтруйте события по дате и типу действия.',
                    'Раздел помогает расследовать инциденты и отслеживать ключевые изменения в системе.',
                ],
            ],
            'settings' => [
                'title' => 'Для чего нужен раздел «Настройки»',
                'text' => [
                    'Управляйте системными параметрами: порогами показателей воды, тайм-аутами редактирования и отображением подсказок.',
            'Отдельный блок «Настройки ФЗП» позволяет задать дни выплаты аванса и основной зарплаты, чтобы график был понятен всем сотрудникам.',
                    'Изменения вступают в силу сразу и фиксируются в журнале активности.',
                ],
            ],
            'duty_calendar' => [
                'title' => 'Для чего нужен раздел «Календарь»',
                'text' => [
            'Администраторы назначают ответственных за дежурства. Смена действует с 08:00 текущего дня до 08:00 следующего.',
            'Назначения автоматически выводятся на дашборде, а пользователи могут просматривать актуальный график в режиме «только чтение».',
                ],
            ],
            'users_admin' => [
                'title' => 'Для чего нужен раздел «Панель администратора»',
                'text' => [
                    'Используется для доступа к инструментам администратора и быстрого перехода к ключевым разделам управления.',
                ],
            ],
        ];

        if (!isset($descriptions[$sectionKey])) {
            return;
        }

        $data = $descriptions[$sectionKey];
        echo '<div class="section-description alert alert-info mt-3">';
        if (!empty($data['title'])) {
            echo '<h5 class="mb-3">' . htmlspecialchars($data['title']) . '</h5>';
        }
        if (!empty($data['text'])) {
            echo '<ul class="mb-0">';
            foreach ($data['text'] as $line) {
                echo '<li>' . htmlspecialchars($line) . '</li>';
            }
            echo '</ul>';
        }
        echo '</div>';
    }
}

