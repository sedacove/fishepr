# Контекст проекта FisherP ERP

Этот файл содержит контекстную информацию о проекте для быстрого понимания структуры и функционала при работе на новом компьютере или с новым разработчиком.

## Общая информация

**Название:** FisherP ERP  
**Тип:** Закрытая ERP система для управления рыбным хозяйством  
**Технологии:**
- Backend: PHP 7.4+ (чистый PHP, без фреймворков)
- База данных: MySQL 5.7+
- Frontend: Bootstrap 5.3, jQuery 3.7, Chart.js 4.4
- Архитектура: MVC (Models, Views, Controllers)

## Основные модули системы

### 1. Управление сессиями (Sessions)
- Создание и управление сессиями выращивания рыбы
- Отслеживание параметров роста (FCR, выживаемость)
- Интеграция с измерениями, смертностью, кормлением

### 2. Бассейны (Pools)
- Управление бассейнами
- Отслеживание загрузки и состояния

### 3. Посадки (Plantings)
- Управление посадками рыбы
- Смешанные посадки (Mixed Plantings)
- Частичные пересадки (Partial Transplants)

### 4. Измерения (Measurements)
- Регистрация измерений параметров воды
- Предупреждения о выходе за нормальные значения
- Интеграция с сессиями

### 5. Смертность (Mortality)
- Учет смертности рыбы
- Связь с сессиями и бассейнами
- Настройки пороговых значений

### 6. Урожаи (Harvests)
- Учет урожаев
- Связь с контрагентами
- Отчеты по урожаям

### 7. Взвешивания (Weighings)
- Регистрация взвешиваний
- Предупреждения о необходимости взвешивания

### 8. Кормление (Feeds)
- Управление кормами
- Учет расхода корма
- Интеграция с сессиями

### 9. Задачи (Tasks)
- Управление задачами
- Загрузка файлов к задачам
- Связь с пользователями

### 10. Сменные задачи (Shift Tasks)
- Шаблоны задач для смен
- Сортировка и порядок выполнения

### 11. Работы (Work / Extra Works)
- Учет выполненных работ
- Дополнительные работы
- Назначение исполнителей

### 12. Показания счетчиков (Meter Readings)
- Учет показаний счетчиков
- Управление счетчиками (Meters)

### 13. Контрагенты (Counterparties)
- Управление контрагентами
- Загрузка файлов
- Связь с урожаями

### 14. Финансы (Finances)
- Учет финансовых операций
- Отчеты по финансам

### 15. Зарплата (Payroll)
- Расчет зарплаты
- Настройки зарплаты
- Связь с пользователями

### 16. Дежурства (Duty Schedule)
- Расписание дежурств
- Календарь дежурств
- Флаг поста (is_fasting)

### 17. Новости (News)
- Управление новостями системы

### 18. Пользователи (Users)
- Управление пользователями
- Роли: admin, user
- Настройки дашборда для каждого пользователя

### 19. Настройки (Settings)
- Системные настройки
- Нормальные значения параметров
- Настройки предупреждений
- Настройки Telegram
- Режим отладки

### 20. Логи (Logs)
- Журнал активности (Activity Log)
- Отслеживание изменений

### 21. Отчеты (Reports)
- Отчеты по урожаям
- Другие отчеты

## Структура проекта

```
fisherp/
├── api/                    # API endpoints (REST API)
├── app/
│   ├── Controllers/       # Контроллеры (MVC)
│   ├── Models/            # Модели данных
│   ├── Repositories/      # Репозитории для работы с БД
│   ├── Services/          # Бизнес-логика
│   ├── Support/           # Вспомогательные классы
│   ├── Views/             # Представления (шаблоны)
│   └── bootstrap.php      # Инициализация приложения
├── assets/                # Статические ресурсы
│   ├── css/              # Стили
│   ├── js/               # JavaScript файлы
│   └── images/           # Изображения
├── auth/                  # Авторизация
├── config/                # Конфигурация
│   ├── config.php        # Основные настройки
│   └── database.php      # Подключение к БД
├── database/              # SQL файлы
│   └── init.sql          # Инициализация БД
├── includes/              # Общие файлы
│   ├── auth.php          # Функции авторизации
│   ├── header.php        # Шапка сайта
│   ├── footer.php        # Подвал
│   ├── dashboard_layout.php  # Макет дашборда
│   └── dashboard_widgets.php # Виджеты дашборда
├── migrations/            # Миграции БД
│   ├── migrate.php       # Скрипт запуска миграций
│   └── 0XX_*.sql         # Файлы миграций
├── templates/             # Шаблоны компонентов
│   ├── pool_block.php    # Блок бассейна
│   ├── task_card.php     # Карточка задачи
│   └── ...
├── uploads/               # Загруженные файлы
│   ├── plantings/        # Файлы посадок
│   └── tasks/            # Файлы задач
└── index.php             # Точка входа
```

## Архитектура

### MVC Pattern
- **Models** (`app/Models/`): Модели данных с бизнес-логикой
- **Views** (`app/Views/`): Представления (HTML шаблоны)
- **Controllers** (`app/Controllers/`): Обработка запросов

### Дополнительные слои
- **Repositories** (`app/Repositories/`): Абстракция доступа к данным
- **Services** (`app/Services/`): Бизнес-логика и сервисы
- **Support** (`app/Support/`): Вспомогательные классы (Router, Exceptions и т.д.)

### Роутинг
Роуты определены в `index.php` через простой роутер.

## База данных

### Миграции
Проект использует систему миграций для управления схемой БД:
- Все миграции в папке `migrations/`
- Нумерация: `001_`, `002_`, `003_` и т.д.
- Запуск: `php migrations/migrate.php run`

### Основные таблицы
- `users` - пользователи
- `sessions` - сессии выращивания
- `pools` - бассейны
- `plantings` - посадки
- `measurements` - измерения
- `mortality` - смертность
- `harvests` - урожаи
- `weighings` - взвешивания
- `feeds` - корма
- `tasks` - задачи
- `shift_tasks` - сменные задачи
- `work` / `extra_works` - работы
- `meters` / `meter_readings` - счетчики
- `counterparties` - контрагенты
- `finances` - финансы
- `duty_schedule` - расписание дежурств
- `news` - новости
- `settings` - настройки
- `activity_log` - журнал активности
- `migrations` - выполненные миграции

## Безопасность

- Авторизация через сессии
- Хеширование паролей (bcrypt)
- Подготовленные запросы (PDO)
- Защита от XSS (htmlspecialchars)
- Настройки безопасности сессий
- Конфигурационные файлы в `.gitignore`

## Важные файлы конфигурации

### `.gitignore`
Игнорируются:
- `/config/config.php` - основные настройки
- `/config/database.php` - настройки БД
- `/.htaccess` - настройки Apache

Эти файлы нужно создать вручную на новом компьютере.

## Тестовые учетные записи

- **Администратор:** `admin` / `password`
- **Пользователь:** `user` / `password`

**ВАЖНО:** В продакшене изменить пароли!

## Установка на новом компьютере

1. Скопировать проект
2. Настроить `config/database.php` и `config/config.php`
3. Запустить миграции: `php migrations/migrate.php run`
4. Проверить права на запись в `uploads/` и `storage/`

## Особенности разработки

- Чистый PHP без фреймворков
- Простой роутер
- Система миграций БД
- MVC архитектура
- API endpoints в папке `api/`
- Загрузка файлов в `uploads/`

## Полезные команды

```bash
# Запуск миграций
php migrations/migrate.php run

# Просмотр статуса миграций
php migrations/migrate.php status
```

## Дата создания контекста

Создан: 2025-01-27

---

**Примечание:** Этот файл можно обновлять по мере развития проекта для сохранения актуального контекста.

